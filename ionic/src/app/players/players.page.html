<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-segment [value]="selectedSegment" (ionChange)="onSegmentChange($event)">
      <ion-segment-button value="players">
        <ion-label>Jugadores</ion-label>
      </ion-segment-button>
      <ion-segment-button value="market">
        <ion-label>Mercado de Pases</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" color="light" class="ion-padding" *ngIf="selectedSegment === 'players'">

  <div *ngIf="players">
    <div *ngFor="let player of players" class="contenedor">

      <!--<div class="image" (click)="goPlayer(player._id)">-->
        <img class="imagen" *ngIf="player.pictureAccept === true " [src]="player.picturePlayer" alt="" (click)="goPlayer(player._id)"/>
        <div class="noAccept" *ngIf="player.pictureAccept === false && player.status === 'pending' && player.picturePlayer !== 'https://res.cloudinary.com/dnv71e5q8/image/upload/v1715194213/profile-empty_fizwea.webp'" (click)="goPlayer(player._id)">
          <img class="imagen" [src]="player.picturePlayer">
          <ion-icon class="icon-timer" color="warning" size="large" name="hourglass-outline"></ion-icon>
        </div>
        <div class="noAccept" *ngIf="player.pictureAccept === false && player.status === 'pending' && player.picturePlayer === 'https://res.cloudinary.com/dnv71e5q8/image/upload/v1715194213/profile-empty_fizwea.webp'" (click)="goPlayer(player._id)">
          <img class="imagen" [src]="player.picturePlayer">
        </div>
        <div class="noAccept" *ngIf="player.pictureAccept === false && player.status === 'rejected'" (click)="goPlayer(player._id)">
          <img class="imagen" src="https://res.cloudinary.com/dnv71e5q8/image/upload/v1715194213/profile-empty_fizwea.webp">
          <ion-icon class="icon-timer" color="danger" size="large" name="close-outline"></ion-icon>
          <p style="color: red; font-weight: bold;" class="overlay-text">Imagen no aprobada</p>
        </div>
      <!--</div>-->
  
      <div class="element-1">
        <ion-item>
          <ion-input (click)="goPlayer(player._id)" readonly="true" labelPlacement="stacked" label="Nombre" [value]="player.firstName + ' ' + player.lastName"></ion-input>
        </ion-item>
      </div>
  
      <div class="element-2">
        <ion-item>
          <ion-input (click)="goPlayer(player._id)" readonly="true" labelPlacement="stacked" label="Fecha de Nacimiento" [value]="player.nacimiento| date: 'dd-MM-yy'"></ion-input>
        </ion-item>
      </div>

      <div class="element-3">
        <ion-item>
          <ion-input (click)="goPlayer(player._id)" readonly="true" labelPlacement="stacked" label="DNI" [value]="player.dni"></ion-input>
        </ion-item>
      </div>
    </div>
  
    <div class="container-button">
      <div class="button" *ngIf="team.active">
        <ion-button shape="round" (click)="setOpen(true)">
          <ion-icon slot="icon-only" name="add-outline"></ion-icon>
        </ion-button>
      </div>
    </div>
  </div>

  <div class="addPlayers" *ngIf="players.length === 0">
    <p>Por favor, crea o elegí un equipo</p>
  </div>

  <div class="players" *ngIf="!players">
    <p>Agrega jugadores a tu equipo</p>
  </div>
  

  <ion-modal [isOpen]="isModalOpen">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="restartPlayers()">Cancel</ion-button>
          </ion-buttons>
          <ion-title>Crear jugador</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="crearJugador(form)">Confirmar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <form [formGroup]="form">
          <ion-list [inset]="true">
            <ion-item>
              <ion-input label="Nombre" labelPlacement="stacked" type="text" placeholder="Ingrese un nombre" formControlName="firstName"></ion-input>
            </ion-item>

            <ion-item>
              <ion-input label="Apellido" labelPlacement="stacked" type="text" placeholder="Ingrese un apellido" formControlName="lastName"></ion-input>
            </ion-item>

            <ion-item>
              <ion-input label="Fecha de Nacimiento" labelPlacement="stacked" type="date" placeholder="Ingrese una edad" formControlName="nacimiento"></ion-input>
            </ion-item>

            <ion-item>
              <ion-input label="DNI" labelPlacement="stacked" type="number" placeholder="Ingrese DNI" formControlName="dni"></ion-input>
            </ion-item>

            <ion-item>
              <div class="foto">
                <label>Foto del Jugador</label>
              </div>
              <ion-input id="fileInput" style="padding: 10px 0;" type="file" (change)="onFileSelected($event)"></ion-input>
            </ion-item>
          </ion-list>
        </form>
      
      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>

<ion-content [fullscreen]="true" color="light" class="ion-padding" *ngIf="selectedSegment === 'market'">

  <div *ngIf="myPlayer">
    <div style="width: 100%; display: flex; justify-content: end;">
      <ion-button (click)="setOpen2(true)">Editar</ion-button>
    </div>
    <div class="contenedor2">
      <img class="image2 imagen" [src]="myPlayer.playerImage"/>
      <div class="element-1">
        <ion-item>
          <ion-input  readonly="true" labelPlacement="stacked" label="Nombre" [value]="myPlayer.nombre + ' ' + myPlayer.apellido"></ion-input>
        </ion-item>
      </div>
  
      <div class="element-2">
        <ion-item>
          <ion-input  readonly="true" labelPlacement="stacked" label="Fecha de Nacimiento" [value]="myPlayer.nacimiento | date: 'dd-MM-yy'"></ion-input>
        </ion-item>
      </div>

      <div class="element-3">
        <ion-item>
          <ion-input  readonly="true" labelPlacement="stacked" label="Posicion" [value]="myPlayer.position"></ion-input>
        </ion-item>
      </div>

      <div class="element-4">
        <ion-item>
          <ion-input  readonly="true" labelPlacement="stacked" label="Pie habil" [value]="myPlayer.pieHabil"></ion-input>
        </ion-item>
      </div>
    </div>
    <hr>
  </div>
  
  <div>
    <div *ngFor="let player of playersMarket" class="contenedor2">
        <img class="image2 imagen" [src]="player.playerImage"/>
      <div class="element-1">
        <ion-item>
          <ion-input  readonly="true" labelPlacement="stacked" label="Nombre" [value]="player.nombre + ' ' + player.apellido"></ion-input>
        </ion-item>
      </div>
  
      <div class="element-2">
        <ion-item>
          <ion-input  readonly="true" labelPlacement="stacked" label="Fecha de Nacimiento" [value]="player.nacimiento | date: 'dd-MM-yy'"></ion-input>
        </ion-item>
      </div>

      <div class="element-3">
        <ion-item>
          <ion-input  readonly="true" labelPlacement="stacked" label="Posicion" [value]="player.position"></ion-input>
        </ion-item>
      </div>

      <div class="element-4">
        <ion-item>
          <ion-input  readonly="true" labelPlacement="stacked" label="Pie habil" [value]="player.pieHabil"></ion-input>
        </ion-item>
      </div>
    </div>
  </div>

  <div class="container-button" *ngIf="user.completedFormMarket === false">
    <div class="button" >
      <ion-button shape="round" id="open-modal-passMarket">
        <ion-icon slot="icon-only" name="add-outline"></ion-icon>
      </ion-button>
    </div>
  </div>

  <ion-modal trigger="open-modal-passMarket" >
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="cancel()">Cancelar</ion-button>
          </ion-buttons>
          <ion-title>Mercado de Pases</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">

        <form [formGroup]="form2" *ngIf="user.completedFormMarket === false">
          <ion-list [inset]="true">
            <ion-item>
              <ion-label>¿Que dias podes jugar?</ion-label>
              <button class="boton-dia" (click)="addDayTournament()">Agregar Día</button>
            </ion-item>

            <ng-container formArrayName="horarios" >
              <ng-container *ngFor="let day of horarios.controls; let i = index" [formGroupName]="i" style="margin-top: 20px;">
                <ion-item lines="full">
                  <ion-select formControlName="dia" placeholder="Selecciona un día" interface="popover" label="Dia">
                    <ion-select-option value="Lunes">Lunes</ion-select-option>
                    <ion-select-option value="Martes">Martes</ion-select-option>
                    <ion-select-option value="Miercoles">Miércoles</ion-select-option>
                    <ion-select-option value="Jueves">Jueves</ion-select-option>
                    <ion-select-option value="Viernes">Viernes</ion-select-option>
                    <ion-select-option value="Sabado">Sábado</ion-select-option>
                    <ion-select-option value="Domingo">Domingo</ion-select-option>
                  </ion-select>
                </ion-item>

                <ion-item>
                  <ion-label>Hora</ion-label>
                  <div style="overflow-x: auto; white-space: nowrap;">
                    <ion-select formControlName="hora" placeholder="Selecciona una hora" multiple="true">
                      <ion-select-option *ngFor="let timeOption of times" [value]="timeOption">{{timeOption}}</ion-select-option>
                    </ion-select>
                  </div>
                </ion-item>
                <div style="width: 100px;">
                  <ion-button (click)="removeDayTournament(i)" color="danger">Eliminar</ion-button>
                </div>
              </ng-container>
            </ng-container>

          </ion-list>
        
          <ion-item>
            <ion-select label="Posición" labelPlacement="floating" formControlName="position" interface="popover">
              <ion-select-option value="Arquero">Arquero</ion-select-option>
              <ion-select-option value="Defensor">Defensor</ion-select-option>
              <ion-select-option value="Mediocampista">Mediocampista</ion-select-option>
              <ion-select-option value="Delantero">Delantero</ion-select-option>
            </ion-select>
          </ion-item>
  
          <ion-item>
            <ion-select label="Pie Hábil" labelPlacement="floating" formControlName="pieHabil" interface="popover">
              <ion-select-option value="Derecho">Derecho</ion-select-option>
              <ion-select-option value="Zurdo">Zurdo</ion-select-option>
              <ion-select-option value="Ambos">Ambos</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-input
              label="Peso"
              labelPlacement="floating"
              type="number"
              formControlName="peso"
              (keypress)="validateInput($event)"
            ></ion-input>
          </ion-item>

          <ion-item>
            <ion-input
              label="Altura"
              labelPlacement="floating"
              type="text"
              placeholder="1.80"
              formControlName="altura"
              (ionInput)="validateInputAltura($event)" 
            ></ion-input>
          </ion-item>
          <ion-item>
            <ion-textarea
              label="Trayectoria Futbolísitica"
              labelPlacement="floating"
              placeholder="Describe tu trayectoria como futbolista..."
              type="text"
              formControlName="trayectoria"
            ></ion-textarea>
          </ion-item>
          <ion-item>
            <ion-select label="Zona de preferencia para jugar" labelPlacement="floating" formControlName="zona" interface="popover">
              <ion-select-option value="CABA">CABA</ion-select-option>
              <ion-select-option value="GBANorte">GBA Norte</ion-select-option>
              <ion-select-option value="GBAOeste">GBA Oeste</ion-select-option>
              <ion-select-option value="GBASur">GBA Sur</ion-select-option>
            </ion-select>
          </ion-item>
        </form>
        <div style="width: 100%; display: flex;justify-content: center; margin-top: 10px;">
          <button class="boton" (click)="ingresarMarket()">
            Enviar
          </button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <ion-modal [isOpen]="isModalOpen2">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="end">
            <ion-button (click)="updateMyPlayer()">Guardar</ion-button>
          </ion-buttons>
          <ion-title>Editar mi Jugador</ion-title>
          <ion-buttons slot="start">
            <ion-button (click)="setOpen2(false)">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">

        <form #miForm>
          <ng-container *ngFor="let horarios of myPlayer.horarios">
            <ion-item>
              <ion-select name="dia" interface="popover" label="Dia" [value]="horarios.dia">
                <ion-select-option value="Lunes">Lunes</ion-select-option>
                <ion-select-option value="Martes">Martes</ion-select-option>
                <ion-select-option value="Miercoles">Miércoles</ion-select-option>
                <ion-select-option value="Jueves">Jueves</ion-select-option>
                <ion-select-option value="Viernes">Viernes</ion-select-option>
                <ion-select-option value="Sabado">Sábado</ion-select-option>
                <ion-select-option value="Domingo">Domingo</ion-select-option>
              </ion-select>
            </ion-item>
            <ion-item>
              <ion-select name="hora" placeholder="Selecciona una hora" multiple="true" label="Hora" [placeholder]="horarios.hora" [value]="dia">
                <ion-select-option *ngFor="let timeOption of times" [value]="timeOption">
                  {{ timeOption }}
                </ion-select-option>
              </ion-select>
            </ion-item>
            <div style="width: 100%; display: flex; justify-content: space-between;">
              <ion-button (click)="editMyHorario(horarios._id, miForm)" color="primary">Editar</ion-button>
              <ion-button (click)="deleteMyHorario(horarios._id)" color="danger">Eliminar</ion-button>
            </div>
            
          </ng-container>
          
        </form>

        <form [formGroup]="form4" >
          <ion-list [inset]="true">
            <ion-item>
              <ion-label>Aagregar Dias</ion-label>
              <button class="boton-dia" (click)="addDayTournament()">Agregar Día</button>
            </ion-item>

            <ng-container formArrayName="horarios" *ngIf="horarios">
              <ng-container *ngFor="let day of horarios.controls; let i = index" [formGroupName]="i" style="margin-top: 20px;">
                <ion-item lines="full">
                  <ion-select formControlName="dia" placeholder="Selecciona un día" interface="popover" label="Dia">
                    <ion-select-option value="Lunes">Lunes</ion-select-option>
                    <ion-select-option value="Martes">Martes</ion-select-option>
                    <ion-select-option value="Miercoles">Miércoles</ion-select-option>
                    <ion-select-option value="Jueves">Jueves</ion-select-option>
                    <ion-select-option value="Viernes">Viernes</ion-select-option>
                    <ion-select-option value="Sabado">Sábado</ion-select-option>
                    <ion-select-option value="Domingo">Domingo</ion-select-option>
                  </ion-select>
                </ion-item>

                <ion-item>
                  <ion-label>Hora</ion-label>
                  <div style="overflow-x: auto; white-space: nowrap;">
                    <ion-select formControlName="hora" placeholder="Selecciona una hora" multiple="true">
                      <ion-select-option *ngFor="let timeOption of times" [value]="timeOption">{{timeOption}}</ion-select-option>
                    </ion-select>
                  </div>
                </ion-item>
                <div style="width: 100px;">
                  <ion-button (click)="removeDayTournament(i)" color="danger">Eliminar</ion-button>
                </div>
              </ng-container>
            </ng-container>

          </ion-list>
        </form>

        <form [formGroup]="form3">
          <ion-item>
            <ion-select label="Posición" labelPlacement="floating" formControlName="position" interface="popover">
              <ion-select-option value="Arquero">Arquero</ion-select-option>
              <ion-select-option value="Defensor">Defensor</ion-select-option>
              <ion-select-option value="Mediocampista">Mediocampista</ion-select-option>
              <ion-select-option value="Delantero">Delantero</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item>
            <ion-select label="Pie Hábil" labelPlacement="floating" formControlName="pieHabil" interface="popover">
              <ion-select-option value="Derecho">Derecho</ion-select-option>
              <ion-select-option value="Zurdo">Zurdo</ion-select-option>
              <ion-select-option value="Ambos">Ambos</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-input
              label="Peso"
              labelPlacement="floating"
              type="number"
              formControlName="peso"
              (keypress)="validateInput($event)"
            ></ion-input>
          </ion-item>

          <ion-item>
            <ion-input
              label="Altura"
              labelPlacement="floating"
              type="text"
              placeholder="1.80"
              formControlName="altura"
              (ionInput)="validateInputAltura($event)" 
            ></ion-input>
          </ion-item>
          <ion-item>
            <ion-textarea
              label="Trayectoria Futbolísitica"
              labelPlacement="floating"
              placeholder="Describe tu trayectoria como futbolista..."
              type="text"
              formControlName="trayectoria"
            ></ion-textarea>
          </ion-item>
          <ion-item>
            <ion-select label="Zona de preferencia para jugar" labelPlacement="floating" formControlName="zona" interface="popover">
              <ion-select-option value="CABA">CABA</ion-select-option>
              <ion-select-option value="GBANorte">GBA Norte</ion-select-option>
              <ion-select-option value="GBAOeste">GBA Oeste</ion-select-option>
              <ion-select-option value="GBASur">GBA Sur</ion-select-option>
            </ion-select>
          </ion-item>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
